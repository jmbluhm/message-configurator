<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Conversation Simulation Tool</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <!-- Password Prompt Overlay -->
    <div id="passwordOverlay" class="password-overlay">
        <div class="password-prompt">
            <h2>Enter Password</h2>
            <p>Please enter the password to access this application.</p>
            <form id="passwordForm">
                <input 
                    type="password" 
                    id="passwordInput" 
                    placeholder="Password" 
                    autocomplete="off"
                    required
                />
                <div id="passwordError" class="password-error" style="display: none;"></div>
                <button type="submit" class="btn btn-primary">Submit</button>
            </form>
        </div>
    </div>
    
    <div class="app-container" id="appContainer" style="display: none;">
        <div class="app-header">
            <h1>Conversation Simulation Tool</h1>
            <div class="conversation-selector">
                <select id="conversationSelect" class="conversation-dropdown">
                    <option value="">Loading conversations...</option>
                </select>
                <button id="createConversationButton" class="btn btn-primary">+ New Conversation</button>
            </div>
        </div>
        
        <!-- Create Conversation Modal -->
        <div id="createConversationModal" class="modal-overlay" style="display: none;">
            <div class="modal-content">
                <h2>Create New Conversation</h2>
                <form id="createConversationForm">
                    <input 
                        type="text" 
                        id="newConversationName" 
                        placeholder="Enter conversation name..." 
                        required
                        autocomplete="off"
                    />
                    <div id="createConversationError" class="modal-error" style="display: none;"></div>
                    <div class="modal-actions">
                        <button type="button" id="cancelCreateConversation" class="btn btn-secondary">Cancel</button>
                        <button type="submit" class="btn btn-primary">Create</button>
                    </div>
                </form>
            </div>
        </div>
        <div class="panels-wrapper">
            <div class="panel editor-panel" id="editorPanel">
            <div class="panel-header">
                <h2>
                    <span style="position: relative; display: inline-block;">
                        Conversation Editor
                        <span class="info-icon" id="conversationEditorInfo" tabindex="0" role="button" aria-label="Conversation Editor help"></span>
                        <div class="tooltip" id="conversationEditorTooltip" role="tooltip">
                            <div class="tooltip-content">
                                <strong>Row Navigation</strong>
                                <ul>
                                    <li><strong>Click a row</strong> to expand or collapse it</li>
                                    <li>Expanded rows show full content in larger textareas</li>
                                    <li>Clicking a row also <strong>scrolls to the corresponding message</strong> in the Conversation panel</li>
                                    <li>Click the same row again to collapse it</li>
                                </ul>
                            </div>
                        </div>
                    </span>
                </h2>
                <div class="header-actions">
                    <button id="saveConversationButton" class="btn btn-primary">Save Changes</button>
                    <button id="downloadCsvButton" class="btn btn-secondary">â¬‡ Download CSV</button>
                    <button id="reloadConversationButton" class="btn btn-secondary">â†» Reload</button>
                    <button id="addRowButton" class="btn btn-secondary">+ Add Row</button>
                </div>
            </div>
            <div class="panel-content">
                <div class="table-container">
                    <table id="conversationTable" class="conversation-table">
                        <thead>
                            <tr>
                                <th>Turn</th>
                                <th>Speaker</th>
                                <th>
                                    <span style="position: relative; display: inline-block;">
                                        Message
                                        <span class="info-icon" id="messageMarkdownInfo" tabindex="0" role="button" aria-label="Markdown syntax help"></span>
                                        <div class="tooltip" id="messageMarkdownTooltip" role="tooltip">
                                        <div class="tooltip-content">
                                            <strong>Markdown Supported</strong>
                                            <ul>
                                                <li><strong>Bold:</strong> <code>**text**</code> or <code>__text__</code></li>
                                                <li><em>Italic:</em> <code>*text*</code> or <code>_text_</code></li>
                                                <li>Inline code: <code>`code`</code></li>
                                                <li>Code block: <code>```code```</code></li>
                                                <li>Links: <code>[text](url)</code></li>
                                                <li>Lists: <code>- item</code> or <code>* item</code></li>
                                                <li>Headers: <code># Header</code></li>
                                                <li>Line breaks are preserved</li>
                                            </ul>
                                        </div>
                                    </div>
                                    </span>
                                </th>
                                <th>
                                    <span style="position: relative; display: inline-block;">
                                        Actions
                                        <span class="info-icon" id="systemActionsInfo" tabindex="0" role="button" aria-label="Actions syntax help"></span>
                                        <div class="tooltip" id="systemActionsTooltip" role="tooltip">
                                        <div class="tooltip-content">
                                            <strong>Actions</strong>
                                            <p>Actions can be associated with any message. Actions for AI Agent messages are System Actions, and actions for Merchant messages are User Actions.</p>
                                            <p>Actions are stored individually in the database. Use the Actions panel to add, edit, or delete actions for each message.</p>
                                        </div>
                                    </div>
                                    </span>
                                </th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="conversationTableBody">
                            <!-- Rows will be inserted here -->
                        </tbody>
                    </table>
                </div>
            </div>
            </div>
        <div class="panel chat-panel">
            <div class="panel-header">
                <h2>
                    <span style="position: relative; display: inline-block;">
                        Conversation
                        <span class="info-icon" id="conversationPanelInfo" tabindex="0" role="button" aria-label="Conversation panel help"></span>
                        <div class="tooltip" id="conversationPanelTooltip" role="tooltip">
                            <div class="tooltip-content">
                                <strong>Edit Messages</strong>
                                <p>Click on any message to edit its content. The message will open in edit mode where you can modify the text and save your changes.</p>
                            </div>
                        </div>
                    </span>
                </h2>
                <button id="resetButton" class="btn btn-primary" title="Reset conversation">â†» Reset</button>
            </div>
            <div class="panel-content chat-messages" id="chatMessages">
                <!-- Messages will be inserted here -->
            </div>
            <div class="chat-input-container">
                <div class="input-wrapper">
                    <textarea 
                        id="messageInput" 
                        placeholder="Type your message..." 
                        autocomplete="off"
                        rows="1"
                    ></textarea>
                    <button id="sendButton" class="btn btn-primary">Send</button>
                </div>
                <div class="auto-fill-indicator" id="autoFillIndicator" style="display: none;">
                    <span>ðŸ’¡ Message auto-filled - edit if needed</span>
                </div>
            </div>
        </div>
        <div class="panel system-notes-panel">
            <div class="panel-header">
                <h2>
                    <span style="position: relative; display: inline-block;">
                        Actions
                        <span class="info-icon" id="systemNotesPanelInfo" tabindex="0" role="button" aria-label="Actions panel help"></span>
                        <div class="tooltip" id="systemNotesPanelTooltip" role="tooltip">
                            <div class="tooltip-content">
                                <strong>Edit Actions</strong>
                                <p>Click on any action to edit its content. Actions can be System Actions (for AI Agent messages) or User Actions (for Merchant messages). You can modify the action description, save your changes, or delete the action entirely.</p>
                            </div>
                        </div>
                    </span>
                </h2>
                <button id="addSystemActionButton" class="btn btn-primary">+ Add Action</button>
            </div>
            <div class="panel-content" id="systemNotes">
                <!-- Actions will be inserted here -->
            </div>
        </div>
        </div>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/marked@11.1.1/marked.min.js"></script>
    <script src="app.js"></script>
</body>
</html>

